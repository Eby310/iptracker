<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IP Address Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #0f0f1a;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      padding: 2rem 1rem;
      text-align: center;
      position: relative;
      z-index: 1000;
    }

    header h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      background: linear-gradient(90deg, #e94560, #e94560);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .search-container {
      max-width: 500px;
      margin: 0 auto;
      display: flex;
      gap: 0;
    }

    .search-container input {
      flex: 1;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 12px 0 0 12px;
      outline: none;
      font-family: inherit;
      background: #fff;
      color: #1a1a2e;
    }

    .search-container input::placeholder {
      color: #888;
    }

    .search-container button {
      padding: 1rem 1.5rem;
      font-size: 1.5rem;
      border: none;
      border-radius: 0 12px 12px 0;
      background: #e94560;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .search-container button:hover {
      background: #c73e54;
    }

    .info-card {
      background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
      max-width: 1100px;
      width: 90%;
      margin: -40px auto 0;
      padding: 2rem;
      border-radius: 15px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 2rem;
      position: relative;
      z-index: 1001;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .info-item {
      text-align: left;
      padding: 0 1rem;
      border-left: 3px solid #e94560;
    }

    .info-item:first-child {
      border-left: none;
    }

    .info-item .label {
      display: block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #888;
      margin-bottom: 0.5rem;
    }

    .info-item .value {
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      word-break: break-word;
    }

    #map {
      flex: 1;
      min-height: 500px;
      width: 100%;
      margin-top: 0;
    }

    .leaflet-container {
      background: #0f0f1a;
    }

    .loading {
      opacity: 0.5;
      pointer-events: none;
    }

    .error-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #e94560;
      color: #fff;
      padding: 1rem 2rem;
      border-radius: 8px;
      z-index: 2000;
      display: none;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    @media (max-width: 900px) {
      .info-card {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
      }

      .info-item {
        border-left: none;
        border-top: 3px solid #e94560;
        padding: 1rem 0 0;
      }

      .info-item:first-child,
      .info-item:nth-child(2) {
        border-top: none;
      }
    }

    @media (max-width: 500px) {
      header h1 {
        font-size: 1.5rem;
      }

      .search-container {
        flex-direction: column;
      }

      .search-container input {
        border-radius: 12px;
        margin-bottom: 0.5rem;
      }

      .search-container button {
        border-radius: 12px;
        padding: 0.8rem;
      }

      .info-card {
        grid-template-columns: 1fr;
        gap: 3rem;
        margin-top: 10px;
      }

      .info-item {
        border-left: none;
        border-top: 3px solid #e94560;
        padding: 1rem 0 0;
      }

      #map {
        min-height: 400px;
      }
    }
  </style>
</head>
<body>
  <div class="error-message" id="error-message"></div>

  <header>
    <h1>IP Address Tracker</h1>
    <form class="search-container" id="search-form">
      <input type="text" id="ip-input" placeholder="Search for any IP address" />
      <button type="submit">â€º</button>
    </form>
  </header>

  <div class="info-card">
    <div class="info-item">
      <span class="label">IP Address</span>
      <span class="value" id="ip-result">-</span>
    </div>
    <div class="info-item">
      <span class="label">Location</span>
      <span class="value" id="location-result">-</span>
    </div>
    <div class="info-item">
      <span class="label">Timezone</span>
      <span class="value" id="timezone-result">-</span>
    </div>
    <div class="info-item">
      <span class="label">ISP</span>
      <span class="value" id="isp-result">-</span>
    </div>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let map;
    let marker;
    let isFirstLoad = true;

    function initMap() {
      map = L.map('map', {
        center: [20, 0],
        zoom: 2,
        zoomControl: true,
        attributionControl: true
      });

      L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 19
      }).addTo(map);
    }

    function updateMarker(lat, lng, location) {
      if (marker) {
        map.removeLayer(marker);
      }

      const customIcon = L.icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
      });

      marker = L.marker([lat, lng], { icon: customIcon }).addTo(map);
      marker.bindPopup(`<b>${location}</b>`).openPopup();
      map.setView([lat, lng], 13);
    }

    function updateDisplay(data) {
      document.getElementById('ip-result').textContent = data.query || data.ip;
      
      const location = data.city ? `${data.city}, ${data.country}` : data.country || '-';
      document.getElementById('location-result').textContent = location;
      
      document.getElementById('timezone-result').textContent = data.timezone ? `UTC ${data.timezone}` : '-';
      document.getElementById('isp-result').textContent = data.isp || data.org || '-';

      if (data.lat && data.lon) {
        updateMarker(data.lat, data.lon, location);
      }
    }

    function showError(message) {
      const errorEl = document.getElementById('error-message');
      errorEl.textContent = message;
      errorEl.style.display = 'block';
      setTimeout(() => {
        errorEl.style.display = 'none';
      }, 3000);
    }

    function fetchIPInfo(ip = '') {
      const form = document.getElementById('search-form');
      form.classList.add('loading');

      // Create a unique callback name
      const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
      
      // Build URL with callback parameter
      const url = ip 
        ? `https://ip-api.com/json/${encodeURIComponent(ip)}?callback=${callbackName}`
        : `https://ip-api.com/json/?callback=${callbackName}`;

      // Create callback function
      window[callbackName] = function(data) {
        if (data.status === 'fail') {
          showError('Invalid IP address or API error');
        } else {
          updateDisplay(data);
        }
        
        // Clean up
        document.head.removeChild(script);
        delete window[callbackName];
        form.classList.remove('loading');
      };

      // Create script element
      const script = document.createElement('script');
      script.src = url;
      
      // Handle errors
      script.onerror = function() {
        showError('Failed to fetch IP information');
        document.head.removeChild(script);
        delete window[callbackName];
        form.classList.remove('loading');
      };

      // Add script to document
      document.head.appendChild(script);
      
      // Timeout fallback
      setTimeout(function() {
        if (window[callbackName]) {
          showError('Request timeout');
          document.head.removeChild(script);
          delete window[callbackName];
          form.classList.remove('loading');
        }
      }, 10000);
    }

    document.getElementById('search-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const ip = document.getElementById('ip-input').value.trim();
      if (ip) {
        fetchIPInfo(ip);
      }
    });

    initMap();
    fetchIPInfo();
  </script>
</body>
</html>
